{% import 'macros/autoform.html' as autoform %}
{% extends "page.html" %}
{% import 'macros/form.html' as form %}

{% block primary_content_inner %}

  {{ form.errors(error_summary) }}

  <div class="shadow-sm mb-4 border-0 card">
    <div class="bg-primary text-white card-header">
      <i class="me-2 fa fa-cogs"></i>{{ _('Konfigurasi Satu Data') }}
    </div>
    <div class="card-body">
      <form method="post" action="" id="admin-config-form" enctype="multipart/form-data">
        {% block admin_form %}
        {{ h.csrf_input() }}

          <div class="mb-3">
            {{ form.input('ckan.site_title', id='field-ckan-site-title',
              label=_('Judul Situs'), value=data['ckan.site_title'],
              error=error, classes=['form-control']) }}
          </div>

          <div class="mb-3">
            {{ form.input('ckan.theme', id='field-ckan-main-css',
              label=_('Custom Stylesheet'), value=data['ckan.theme'],
              error=error, classes=['form-control']) }}
          </div>

          <div class="mb-3">
            {{ form.input('ckan.site_description', id='field-ckan-site-description',
              label=_('Site Tag Line'), value=data['ckan.site_description'],
              error=error, classes=['form-control']) }}
          </div>

          <div class="mb-3">
            {% set field_url = 'ckan.site_logo' %}
            {% set is_upload = data[field_url] and not data[field_url].startswith('http') %}
            {% set is_url = data[field_url] and data[field_url].startswith('http') %}
            {{ form.image_upload(
                data, errors, is_upload_enabled=h.uploads_enabled(),
                is_url=is_url, is_upload=is_upload,
                upload_label = _('Logo situs'), url_label=_('Logo situs'),
                field_url=field_url, field_upload='logo_upload',
                field_clear='clear_logo_upload'
            ) }}
          </div>

          <div class="mb-3">
            {{ form.markdown('ckan.site_about', id='field-ckan-site-about',
              label=_('Tentang'), value=data['ckan.site_about'], error=error,
              placeholder=_('Deskripsi Tentang')) }}
          </div>

          <div class="mb-3">
            {{ form.markdown('ckan.site_intro_text', id='field-ckan-site-intro-text',
              label=_('Teks Pembuka'), value=data['ckan.site_intro_text'], error=error,
              placeholder=_('Teks di halaman utama')) }}
          </div>

          <div class="mb-3">
            {{ form.textarea('ckan.site_custom_css', id='field-ckan-site-custom-css',
              label=_('Custom CSS'), value=data['ckan.site_custom_css'],
              error=error, placeholder=_('Customisable css inserted into the page header')) }}
          </div>

        {% endblock %}

        <div class="d-flex justify-content-between mt-4">
          <a href="{% url_for 'admin.reset_config' %}" 
             class="btn-outline-danger btn"
             data-module="confirm-action" 
             data-module-content="{{ _('Are you sure you want to reset the config?') }}">
             <i class="me-1 fa fa-undo"></i>{{ _('Reset') }}
          </a>
          <button type="submit" class="btn btn-primary" name="save">
            <i class="me-1 fa fa-save"></i>{{ _('Perbarui Konfigurasi') }}
          </button>
        </div>
      </form>
    </div>
  </div>

{% endblock %}

{% block secondary_content %}
  <div class="shadow-sm border-0 card">
    <div class="bg-dark text-white card-header">
      <i class="me-2 fa fa-info-circle"></i>{{ _('Administrator Satu Data Deli Serdang') }}
    </div>
    <div class="card-body">
      <ul class="flex-column bg-light shadow-sm mb-4 p-2 rounded nav">
            <li class="mb-2 nav-item">
                {{ h.build_nav_icon('admin.index', _('Admin'), icon='gavel') }}
            </li>
            <li class="mb-2 nav-item">
                {{ h.build_nav_icon('admin.config', _('Konfigurasi'), icon='gear') }}
            </li>
            <li class="mb-2 nav-item">
                {{ h.build_nav_icon('admin.trash', _('Sampah'), icon='trash') }}
            </li>
        </ul>
    </div>
  </div>
{% endblock %}
